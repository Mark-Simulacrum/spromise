/**
 * spromise Copyright (c) 2014 Miguel Castillo.
 * Licensed under MIT
 *
 * https://github.com/MiguelCastillo/spromise
 */

/**
 * spromise Copyright (c) 2014 Miguel Castillo.
 * Licensed under MIT
 */

(function(e,t){typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?module.exports=t():typeof define=="function"&&define.amd?define(t):e.spromise=t()})(this,function(){var e,t;(function(){function i(e){return typeof e.factory=="function"?t(e.deps,e.factory):e.factory}function s(e,t){var n,s,o,u,a=[];for(n=0,s=e.length;n<s;n++){o=e[n],u=r[o]||t[o];if(!u)throw new TypeError("Module "+o+" has not yet been loaded");r[o]?(u.hasOwnProperty("code")||(u.code=i(u)),a[n]=u.code):a[n]=u}return a}var n=this,r={};t=function o(e,t){var i,u,a={};return a.require=o,a.exports={},a.module={exports:a.exports},typeof e=="string"&&(i=e,e=[e]),e.length&&(e=s(e.slice(0),a)),typeof t=="function"?u=t.apply(n,e):u=r[i]?r[i].code:t,u===void 0?a.module.exports:u},e=function(t,n,i){r[t]={name:t,deps:n,factory:i}}}).call(this),e("src/samdy",function(){});var n=this;return e("src/async",["require","exports","module"],function(e,t,r){function o(e){s(e)}var i=n,s;i.setImmediate?s=i.setImmediate:i.process&&typeof i.process.nextTick=="function"?s=i.process.nextTick:s=function(e){i.setTimeout(e,0)},o.delay=function(e,t,n){i.setTimeout(e.apply.bind(e,this,n||[]),t)},r.exports=o}),e("src/promise",["require","exports","module","src/async"],function(e,t,n){function o(e,t){if(this instanceof o==0)return new o(e,t);var n=this;t instanceof u==0&&(t=new u),n.then=function(e,n){return t.then(e,n)},n.resolve=function(){return t.transition(i.resolved,arguments,this),n},n.reject=function(){return t.transition(i.rejected,arguments,this),n},n.done=function(e){return t.enqueue(i.resolved,e),n.promise},n.catch=n.fail=function(e){return t.enqueue(i.rejected,e),n.promise},n.finally=n.always=function(e){return t.enqueue(i.always,e),n.promise},n.notify=function(e,r){return t.enqueue(i.notify,e,r),n.promise},n.state=function(){return s[t.state]},n.isPending=function(){return t.state===i.pending},n.isResolved=function(){return t.state===i.resolved},n.isRejected=function(){return t.state===i.resolved},n.promise={then:n.then,always:n.always,done:n.done,"catch":n.fail,fail:n.fail,notify:n.notify,state:n.state},n.promise.promise=n.promise,n.then.constructor=o,typeof e=="function"&&e.call(n,n.resolve,n.reject)}function u(e){this.state=i.pending,e&&e.state&&this.transition(e.state,e.value,e.context)}function a(e){this.stateManager=e.stateManager,this.promise=e.promise}var r=e("src/async"),i={pending:0,resolved:1,rejected:2,always:3,notify:4},s=["pending","resolved","rejected"];o.prototype.delay=function(t){var n=this;return new o(function(e,i){n.then(function(){r.delay(e.bind(this),t,arguments)},i.bind(this))})},o.defer=function(){return new o},o.reject=function(){return new o(null,new u({context:this,value:arguments,state:i.rejected}))},o.resolve=o.thenable=function(e){if(e){if(e instanceof o==1)return e;if(typeof e.then=="function")return new o(e.then)}return new o(null,new u({context:this,value:arguments,state:i.resolved}))},o.delay=function(t){var n=Array.prototype.slice(arguments,1);return new o(function(e){r.delay(e.bind(this),t,n)})},u.prototype.enqueue=function(e,t,n){var s=this,o=this.state;o?o===e||i.always===e?n?t.apply(s.context,s.value):r(function(){t.apply(s.context,s.value)}):i.notify===e&&(n?t.call(s.context,s.state,s.value):r(function(){t.call(s.context,s.state,s.value)})):(this.queue||(this.queue=[])).push({state:e,cb:t})},u.prototype.transition=function(e,t,n,r){if(this.state)return;this.state=e,this.context=n,this.value=t;if(this.queue){var i,s=this.queue,o=s.length,u=0;this.queue=null;while(u<o)i=s[u++],this.enqueue(i.state,i.cb,r)}},u.prototype.then=function(e,t){e=typeof e=="function"?e:null,t=typeof t=="function"?t:null;if(!e&&this.state===i.resolved||!t&&this.state===i.rejected)return new o(null,this);var n=new u,r=new o(null,n);return this.enqueue(i.notify,function(s,o){var u=new a({stateManager:n,promise:r}),f=s===i.resolved?e||t:t||e;if(f)try{o=[f.apply(this,o)]}catch(l){return r.reject.call(this,l)}u.tryFinalize(s,o,this)}),r},a.prototype.delegate=function(){var e=this;return function(n,r){e.tryFinalize(n,r,this)}},a.prototype.chain=function(e){var t=this;return function(){t.resolved||(t.resolved=!0,t.tryFinalize(e,arguments,this))}},a.prototype.tryFinalize=function(e,t,n){try{this.finalize(e,t,n)}catch(r){this.promise.reject.call(n,r)}},a.prototype.finalize=function(e,t,n){var r=this.promise,s=t[0],u=s&&s.then;if(s===r)throw new TypeError("Resolution input must not be the promise being resolved");if(u&&u.constructor===o)return s.notify(this.delegate());var f=u&&typeof u=="function"&&typeof s;if(f==="function"||f==="object"){var l=new a(this);try{u.call(s,l.chain(i.resolved),l.chain(i.rejected))}catch(c){l.resolved||r.reject.call(n,c)}}else this.stateManager.transition(e,t,n,!0)},o.states=i,n.exports=o}),e("src/all",["require","exports","module","src/promise","src/async"],function(e,t,n){function s(e,t,n){return typeof e=="function"?e.apply(n,t||[]):e}function o(e){function a(){u--,u||n.resolve.call(o,t)}function f(e){return function(){t[e]=arguments.length===1?arguments[0]:arguments,a()}}function l(){var r,i,o;for(r=0,o=u;r<o;r++)i=e[r],i&&typeof i.then=="function"?i.then(f(r),n.reject):(t[r]=s(i),a())}e=e||[];var t=[],n=r.defer(),o=this,u=e.length;return e.length?(i(l),n):n.resolve(e)}var r=e("src/promise"),i=e("src/async");n.exports=o}),e("src/when",["require","exports","module","src/promise","src/all"],function(e,t,n){function s(){var e=this,t=arguments;return new r(function(n,r){i.call(e,t).then(function(t){n.apply(e,t)},function(t){r.call(e,t)})})}var r=e("src/promise"),i=e("src/all");n.exports=s}),e("src/race",["require","exports","module","src/promise"],function(e,t,n){function i(e){return e?new r(function(t,n){function o(){s||(s=!0,t.apply(this,arguments))}function u(){s||(s=!0,n.apply(this,arguments))}var r,i,s=!1;for(r=0,i=e.length;r<i;r++)e[r].then(o,u)}):r.resolve()}var r=e("src/promise");n.exports=i}),e("src/spromise",["require","exports","module","src/promise","src/async","src/when","src/all","src/race"],function(e,t,n){var r=e("src/promise");r.aync=e("src/async"),r.when=e("src/when"),r.all=e("src/all"),r.race=e("src/race"),n.exports=r}),t("src/spromise")});